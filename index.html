<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>UI Wireframe Tool — Resizable Handles</title>
<style>
  :root{--sidebar:340px;--gap:10px}
  body{margin:0;font-family:Inter,system-ui,Segoe UI,Roboto,Arial,height:100vh;display:flex;gap:var(--gap)}
  #sidebar{width:var(--sidebar);padding:14px;box-sizing:border-box;border-right:1px solid #e6e6e6;background:#fbfbfd;overflow:auto}
  #main{flex:1;display:flex;flex-direction:column}
  header{height:56px;display:flex;align-items:center;gap:12px;padding:8px 16px;border-bottom:1px solid #eee}
  #canvasWrap{flex:1;display:flex;align-items:start;justify-content:center;padding:20px;background:#fff;overflow:auto}
  .device-frame{background:#f3f4f6;border-radius:12px;padding:16px;box-shadow:0 8px 22px rgba(12,12,12,0.06);display:flex;align-items:center;justify-content:center}
  #canvas{position:relative;background:#fff;box-shadow:0 2px 8px rgba(10,10,10,0.04);overflow:visible}
  .elem{position:absolute;display:flex;align-items:center;justify-content:center;box-sizing:border-box;cursor:move;user-select:none;border:1px solid rgba(0,0,0,0.08)}
  .elem.btn{color:#fff}
  .elem .canvas-delete { position:absolute; top: -8px; right: -8px; width:22px; height:22px; border-radius:50%; background:#ff4d4f; color:#fff; display:flex; align-items:center; justify-content:center; font-weight:700; cursor:pointer; box-shadow:0 2px 6px rgba(0,0,0,0.2); z-index:30; }
  .resize-handle { position:absolute; width:10px; height:10px; background:#fff; border:2px solid #2563eb; border-radius:2px; box-shadow:0 2px 6px rgba(0,0,0,0.12); z-index:50; cursor: nwse-resize; }
  .handle-n { cursor: ns-resize; transform:translate(-50%,-50%); }
  .handle-s { cursor: ns-resize; transform:translate(-50%,-50%); }
  .handle-w { cursor: ew-resize; transform:translate(-50%,-50%); }
  .handle-e { cursor: ew-resize; transform:translate(-50%,-50%); }
  .handle-ne { cursor: nesw-resize; transform:translate(-50%,-50%); }
  .handle-nw { cursor: nwse-resize; transform:translate(-50%,-50%); }
  .handle-se { cursor: nwse-resize; transform:translate(-50%,-50%); }
  .handle-sw { cursor: nesw-resize; transform:translate(-50%,-50%); }
  .controls section{margin-top:12px}
  input,select,textarea,button{font-size:13px;padding:6px;border:1px solid #ddd;border-radius:6px;background:#fff}
  .row{display:flex;gap:8px;align-items:center}
  #pagesList{display:flex;flex-direction:column;gap:8px;margin-top:8px}
  .pageItem{display:flex;gap:6px;align-items:center}
  .pageItem button{padding:6px 8px}
  .selectedPage{background:#e9f6ff}
  label{display:flex;flex-direction:column;font-size:13px;gap:6px}
  #jsonArea{width:100%;height:120px;box-sizing:border-box}
  .muted{color:#6b7280;font-size:13px}
  small{color:#6b7280}
  #previewOverlay{display:none;position:fixed;inset:0;background:rgba(0,0,0,0.25);align-items:center;justify-content:center}
  #previewWindow{width:420px;height:800px;background:#fff;border-radius:10px;overflow:hidden;box-shadow:0 10px 40px rgba(0,0,0,0.35);position:relative}
  #previewCanvas{width:100%;height:100%;position:relative;background:#f7f7f7;overflow:hidden}
  .control-grid {display:grid; grid-template-columns: 1fr 1fr; gap:8px;}
</style>
</head>
<body>
  <div id="sidebar">
    <strong>Pages</strong>
    <div id="pagesList"></div>
    <div class="row" style="margin-top:8px">
      <input id="newPageName" placeholder="New page name" style="flex:1"/>
      <button id="addPageBtn">Add</button>
    </div>

    <div class="controls">
      <section>
        <strong>Elements</strong>
        <div style="margin-top:8px" class="row">
          <select id="shapeSelect">
            <option value="box">Box</option>
            <option value="circle">Circle</option>
            <option value="ellipse">Ellipse</option>
            <option value="line">Line</option>
            <option value="button">Button</option>
          </select>
          <button id="addShape">Add</button>
        </div>
        <small class="muted">Choose shape then Add</small>
      </section>

      <section>
        <strong>Selected element</strong>
        <div id="selInfo" class="muted">None</div>
        <label>Label<input id="labelInput" /></label>

        <div class="control-grid">
          <label>W<input id="widthInput" type="number" /></label>
          <label>H<input id="heightInput" type="number" /></label>
        </div>

        <div class="control-grid">
          <label>Corner radius<input id="cornerRadius" type="number" min="0" /></label>
          <label>Border width<input id="borderWidth" type="number" min="0" /></label>
        </div>

        <div class="control-grid">
          <label>Border style
            <select id="borderStyle">
              <option value="solid">solid</option>
              <option value="dashed">dashed</option>
              <option value="dotted">dotted</option>
            </select>
          </label>
          <label>Border color<input id="borderColor" type="color" /></label>
        </div>

        <label>Background type
          <select id="bgType">
            <option value="solid">Solid</option>
            <option value="linear">Linear gradient</option>
            <option value="radial">Radial gradient</option>
          </select>
        </label>

        <div class="row" style="margin-top:6px">
          <label style="flex:1">Color A<input id="bgA" type="color" /></label>
          <label style="flex:1">Color B<input id="bgB" type="color" /></label>
        </div>

        <label id="dirLabel">Direction
          <select id="bgDir">
            <option value="to right">to right</option>
            <option value="to left">to left</option>
            <option value="to bottom">to bottom</option>
            <option value="to top">to top</option>
            <option value="45deg">45deg</option>
          </select>
        </label>

        <label>Text color<input id="textColor" type="color" /></label>

        <label>Action type
          <select id="actionType">
            <option value="">None</option>
            <option value="alert">Show alert</option>
            <option value="openUrl">Open URL</option>
            <option value="navigate">Navigate to page</option>
          </select>
        </label>

        <label id="actionValueLabel">Action value
          <input id="actionValue" placeholder="Message, URL, or page id" />
          <select id="actionPageSelect" style="margin-top:6px;display:none"></select>
        </label>

        <div class="row" style="margin-top:8px">
          <button id="applyBtn">Apply</button>
          <button id="deleteBtn">Delete</button>
        </div>
      </section>

      <section>
        <strong>Devices</strong>
        <div class="row" style="margin-top:8px">
          <select id="deviceSelect" style="flex:1">
            <option value="1366x768">Desktop 1366×768</option>
            <option value="1280x800">Laptop 1280×800</option>
            <option value="1024x768">Laptop 1024×768</option>
            <option value="1024x1366">iPad Pro 1024×1366</option>
            <option value="768x1024">Tablet 768×1024</option>
            <option value="414x896">Mobile Large 414×896</option>
            <option value="375x812">Mobile 375×812</option>
          </select>
          <button id="fitBtn">Fit</button>
        </div>
        <div style="margin-top:8px"><small>Canvas size: <span id="sizeInfo">—</span></small></div>
      </section>

      <section>
        <strong>Project</strong>
        <div class="row" style="margin-top:8px">
          <button id="exportBtn">Export JSON</button>
          <button id="importBtn">Import JSON</button>
        </div>
        <textarea id="jsonArea" placeholder="Project JSON"></textarea>
        <div class="row" style="margin-top:8px">
          <button id="previewBtn">Preview</button>
          <button id="copyBtn">Copy JSON</button>
        </div>
      </section>
    </div>
  </div>

  <div id="main">
    <header>
      <strong id="currentPageTitle">No page</strong>
      <div style="flex:1"></div>
      <small class="muted">Scale preview when editing</small>
    </header>

    <div id="canvasWrap">
      <div id="deviceFrame" class="device-frame">
        <div id="canvas" style="width:1024px;height:700px"></div>
      </div>
    </div>
  </div>

  <div id="previewOverlay">
    <div id="previewWindow">
      <div id="previewCanvas"></div>
    </div>
  </div>

<script>
/* Editor with resizer handles */
const state = { pages: [], currentPageId: null, selected: null, device:{w:1024,h:700} };

/* DOM refs */
const pagesList = document.getElementById('pagesList');
const canvas = document.getElementById('canvas');
const deviceFrame = document.getElementById('deviceFrame');
const sizeInfo = document.getElementById('sizeInfo');

const newPageName = document.getElementById('newPageName');
const addPageBtn = document.getElementById('addPageBtn');

const shapeSelect = document.getElementById('shapeSelect');
const addShape = document.getElementById('addShape');

const selInfo = document.getElementById('selInfo');
const labelInput = document.getElementById('labelInput');
const widthInput = document.getElementById('widthInput');
const heightInput = document.getElementById('heightInput');
const cornerRadius = document.getElementById('cornerRadius');
const borderWidth = document.getElementById('borderWidth');
const borderStyle = document.getElementById('borderStyle');
const borderColor = document.getElementById('borderColor');

const bgType = document.getElementById('bgType');
const bgA = document.getElementById('bgA');
const bgB = document.getElementById('bgB');
const bgDir = document.getElementById('bgDir');
const dirLabel = document.getElementById('dirLabel');
const textColor = document.getElementById('textColor');

const actionType = document.getElementById('actionType');
const actionValue = document.getElementById('actionValue');
const actionPageSelect = document.getElementById('actionPageSelect');

const applyBtn = document.getElementById('applyBtn');
const deleteBtn = document.getElementById('deleteBtn');

const deviceSelect = document.getElementById('deviceSelect');
const fitBtn = document.getElementById('fitBtn');

const exportBtn = document.getElementById('exportBtn');
const importBtn = document.getElementById('importBtn');
const jsonArea = document.getElementById('jsonArea');
const previewBtn = document.getElementById('previewBtn');
const previewOverlay = document.getElementById('previewOverlay');
const previewCanvas = document.getElementById('previewCanvas');
const copyBtn = document.getElementById('copyBtn');

function mkId(p='id'){ return p + '_' + Math.random().toString(36).slice(2,9); }
function findPage(id){ return state.pages.find(p=>p.id===id); }

/* Device and canvas scaling */
function applyDevice(){
  const maxW = Math.min(window.innerWidth - 420, 1200);
  const maxH = window.innerHeight - 140;
  const scale = Math.min(maxW / state.device.w, maxH / state.device.h, 1);
  deviceFrame.style.width = (state.device.w * scale + 32) + 'px';
  deviceFrame.style.height = (state.device.h * scale + 32) + 'px';
  canvas.style.width = state.device.w + 'px';
  canvas.style.height = state.device.h + 'px';
  canvas.style.transform = 'scale(' + scale + ')';
  canvas.style.transformOrigin = 'top left';
  sizeInfo.textContent = state.device.w + ' × ' + state.device.h;
}

/* Pages */
function renderPagesList(){
  pagesList.innerHTML = '';
  state.pages.forEach(p=>{
    const div = document.createElement('div'); div.className='pageItem';
    if(p.id === state.currentPageId) div.classList.add('selectedPage');
    const btn = document.createElement('button'); btn.textContent = p.name;
    btn.onclick = ()=> { state.currentPageId = p.id; render(); };
    const rn = document.createElement('button'); rn.textContent='Rename';
    rn.onclick = ()=> { const n = prompt('Rename page', p.name); if(n){ p.name=n; renderPagesList(); render(); } };
    const del = document.createElement('button'); del.textContent='Delete';
    del.onclick = ()=> { if(!confirm('Delete page?')) return; state.pages = state.pages.filter(x=>x.id!==p.id); if(state.currentPageId===p.id) state.currentPageId = state.pages[0]?.id || null; renderPagesList(); render(); };
    div.appendChild(btn); div.appendChild(rn); div.appendChild(del);
    pagesList.appendChild(div);
  });
  document.getElementById('currentPageTitle').textContent = findPage(state.currentPageId)?.name || 'No page';
  // populate page select for navigation actions
  actionPageSelect.innerHTML = ''; const emptyOpt = document.createElement('option'); emptyOpt.value=''; emptyOpt.textContent='Select page'; actionPageSelect.appendChild(emptyOpt);
  state.pages.forEach(p => { const o = document.createElement('option'); o.value = p.id; o.textContent = p.name; actionPageSelect.appendChild(o); });
}

/* Render canvas elements and add resize handles for selected */
function render(){
  renderPagesList();
  canvas.innerHTML = '';
  const page = findPage(state.currentPageId);
  if(!page) return;
  page.elements.forEach(el=>{
    const d = document.createElement('div');
    d.className = 'elem';
    d.style.left = el.x + 'px'; d.style.top = el.y + 'px';
    d.style.width = el.width + 'px'; d.style.height = el.height + 'px';
    d.style.display = 'flex'; d.style.alignItems='center'; d.style.justifyContent='center';
    d.style.color = el.textColor || '#000';
    d.dataset.id = el.id;
    d.textContent = (el.type==='button' || el.type==='box') ? (el.label || (el.type==='button' ? 'Button' : 'Box')) : '';
    // shape rendering
    if(el.type === 'circle'){ d.style.borderRadius = '50%'; }
    else if(el.type === 'ellipse'){ d.style.borderRadius = '50% / 30%'; }
    else if(el.type === 'line'){ d.style.height = Math.max(2, el.borderWidth || 2) + 'px'; d.style.width = el.width + 'px'; d.style.display = 'block'; d.textContent = ''; }
    else { d.style.borderRadius = (el.cornerRadius != null ? el.cornerRadius + 'px' : '8px'); }
    // border
    d.style.borderStyle = el.borderStyle || 'solid';
    d.style.borderWidth = (el.borderWidth != null ? el.borderWidth + 'px' : '0px');
    d.style.borderColor = el.borderColor || 'transparent';
    // background
    if(el.bgType === 'solid') d.style.background = el.bgA || 'transparent';
    else if(el.bgType === 'linear') d.style.background = `linear-gradient(${el.bgDir||'to right'}, ${el.bgA}, ${el.bgB})`;
    else if(el.bgType === 'radial') d.style.background = `radial-gradient(circle, ${el.bgA}, ${el.bgB})`;
    if(el.type==='button'){ d.classList.add('btn'); d.style.border = 'none'; d.style.color = el.textColor || '#fff'; }
    // events
    d.addEventListener('mousedown', startDrag);
    d.addEventListener('dblclick', ()=>{ state.selected = { pageId: page.id, id: el.id }; openSelected(); });
    d.addEventListener('click', (ev)=>{ ev.stopPropagation(); state.selected = { pageId: page.id, id: el.id }; openSelected(); render(); });
    canvas.appendChild(d);

    // show delete X on selected element
    if(state.selected && state.selected.pageId === page.id && state.selected.id === el.id){
      const delBtn = document.createElement('div');
      delBtn.className = 'canvas-delete';
      delBtn.textContent = '×';
      delBtn.title = 'Delete element';
      delBtn.addEventListener('click', (ev)=>{
        ev.stopPropagation();
        page.elements = page.elements.filter(x=>x.id !== el.id);
        state.selected = null;
        render();
      });
      d.appendChild(delBtn);

      // add 8 resize handles
      const handles = ['nw','n','ne','e','se','s','sw','w'];
      handles.forEach(h=>{
        const hh = document.createElement('div');
        hh.className = 'resize-handle handle-' + h + ' handle-' + h;
        hh.dataset.handle = h;
        // position handle
        const pos = {
          nw: { left: '0%', top: '0%', transform: 'translate(-50%,-50%)' },
          n:  { left: '50%', top: '0%', transform: 'translate(-50%,-50%)' },
          ne: { left: '100%', top: '0%', transform: 'translate(-50%,-50%)' },
          e:  { left: '100%', top: '50%', transform: 'translate(-50%,-50%)' },
          se: { left: '100%', top: '100%', transform: 'translate(-50%,-50%)' },
          s:  { left: '50%', top: '100%', transform: 'translate(-50%,-50%)' },
          sw: { left: '0%', top: '100%', transform: 'translate(-50%,-50%)' },
          w:  { left: '0%', top: '50%', transform: 'translate(-50%,-50%)' }
        }[h];
        hh.style.left = pos.left; hh.style.top = pos.top;
        hh.style.transform = pos.transform;
        // cursor styling by class already in CSS
        hh.addEventListener('mousedown', initResize);
        d.appendChild(hh);
      });
    }
  });
  openSelected();
}

/* Dragging */
let drag = null;
function startDrag(e){
  e.preventDefault();
  const id = e.currentTarget.dataset.id;
  const page = findPage(state.currentPageId);
  const el = page.elements.find(it=>it.id===id);
  // ignore mousedown if it's on a resize handle or delete button
  if(e.target.classList.contains('resize-handle') || e.target.classList.contains('canvas-delete')) return;
  drag = { el, offsetX: e.offsetX, offsetY: e.offsetY };
  document.addEventListener('mousemove', dragging);
  document.addEventListener('mouseup', endDrag, { once: true });
}
function dragging(e){
  if(!drag) return;
  const rect = canvas.getBoundingClientRect();
  drag.el.x = Math.max(0, Math.round(e.clientX - rect.left - drag.offsetX));
  drag.el.y = Math.max(0, Math.round(e.clientY - rect.top - drag.offsetY));
  render();
}
function endDrag(){ document.removeEventListener('mousemove', dragging); drag = null; }

/* Resizing */
let resizeState = null;
function initResize(e){
  e.stopPropagation();
  const handle = e.currentTarget.dataset.handle;
  // find parent element
  let parent = e.currentTarget.parentElement;
  while(parent && !parent.dataset.id) parent = parent.parentElement;
  if(!parent) return;
  const id = parent.dataset.id;
  const page = findPage(state.currentPageId);
  const el = page.elements.find(it=>it.id===id);
  const rect = canvas.getBoundingClientRect();
  resizeState = {
    el,
    handle,
    startX: e.clientX,
    startY: e.clientY,
    orig: { x: el.x, y: el.y, w: el.width, h: el.height },
    canvasRect: rect,
    minW: 20,
    minH: 20
  };
  document.addEventListener('mousemove', doResize);
  document.addEventListener('mouseup', endResize, { once: true });
}
function doResize(e){
  if(!resizeState) return;
  const rs = resizeState;
  const dx = Math.round((e.clientX - rs.startX) / (rs.canvasRect.width / parseFloat(canvas.style.width || rs.canvasRect.width)));
  const dy = Math.round((e.clientY - rs.startY) / (rs.canvasRect.height / parseFloat(canvas.style.height || rs.canvasRect.height)));
  let nx = rs.orig.x, ny = rs.orig.y, nw = rs.orig.w, nh = rs.orig.h;
  // handle: nw n ne e se s sw w
  if(rs.handle.includes('e')) nw = Math.max(rs.minW, rs.orig.w + dx);
  if(rs.handle.includes('s')) nh = Math.max(rs.minH, rs.orig.h + dy);
  if(rs.handle.includes('w')) { nw = Math.max(rs.minW, rs.orig.w - dx); nx = rs.orig.x + (rs.orig.w - nw); }
  if(rs.handle.includes('n')) { nh = Math.max(rs.minH, rs.orig.h - dy); ny = rs.orig.y + (rs.orig.h - nh); }
  // apply rounded values
  rs.el.x = Math.max(0, nx);
  rs.el.y = Math.max(0, ny);
  rs.el.width = Math.max(rs.minW, nw);
  rs.el.height = Math.max(rs.minH, nh);
  // update inspector inputs live if selected
  if(state.selected && state.selected.id === rs.el.id) {
    widthInput.value = rs.el.width;
    heightInput.value = rs.el.height;
    // position inputs not implemented in inspector (keeps simple)
  }
  render();
}
function endResize(){ document.removeEventListener('mousemove', doResize); resizeState = null; }

/* Creation */
addPageBtn.onclick = ()=>{ const name = newPageName.value.trim() || 'Page'; createPage(name); newPageName.value=''; };
function createPage(name){ const p = { id: mkId('page'), name: name || 'Page', elements: [] }; state.pages.push(p); state.currentPageId = p.id; renderPagesList(); render(); }

addShape.onclick = ()=>{
  const type = shapeSelect.value;
  const page = findPage(state.currentPageId);
  if(!page) return alert('Create a page first');
  let el = { id: mkId('el'), type, x:40, y:40, width:160, height:80, label: (type==='button'?'Action':'Box'),
             bgType:'solid', bgA:'#ffffff', bgB:'#ffffff', bgDir:'to right', textColor:'#000',
             cornerRadius:8, borderWidth:0, borderStyle:'solid', borderColor:'#000', action:{type:'',value:''} };
  if(type === 'circle'){ el.width = 100; el.height = 100; }
  if(type === 'ellipse'){ el.width = 160; el.height = 100; }
  if(type === 'line'){ el.width = 200; el.height = 4; el.borderWidth = 2; }
  if(type === 'button'){ el.bgA = '#007bff'; el.textColor = '#fff'; el.width = 160; el.height = 44; }
  page.elements.push(el);
  render();
};

/* Selection & Inspector */
function openSelected(){
  const s = state.selected;
  if(!s){
    selInfo.textContent='None';
    labelInput.value=''; widthInput.value=''; heightInput.value='';
    cornerRadius.value=''; borderWidth.value=''; borderStyle.value='solid'; borderColor.value='#000000';
    bgType.value='solid'; bgA.value='#ffffff'; bgB.value='#ffffff'; bgDir.value='to right'; textColor.value='#000000';
    actionType.value=''; actionValue.value=''; actionPageSelect.style.display='none'; actionValue.style.display='block';
    return;
  }
  const page = findPage(s.pageId); const el = page.elements.find(x=>x.id===s.id);
  if(!el) return;
  selInfo.textContent = el.type + ' • ' + el.id;
  labelInput.value = el.label || '';
  widthInput.value = el.width;
  heightInput.value = el.height;
  cornerRadius.value = el.cornerRadius ?? '';
  borderWidth.value = el.borderWidth ?? 0;
  borderStyle.value = el.borderStyle || 'solid';
  borderColor.value = el.borderColor || '#000000';
  bgType.value = el.bgType || 'solid';
  bgA.value = el.bgA || '#ffffff';
  bgB.value = el.bgB || el.bgA || '#ffffff';
  bgDir.value = el.bgDir || 'to right';
  textColor.value = el.textColor || '#000000';
  actionType.value = el.action?.type || '';
  actionValue.value = el.action?.value || '';
  actionPageSelect.value = el.action?.value || '';
  updateBgControls();
  updateActionControls();
}
canvas.addEventListener('click', (e)=>{ if(e.target === canvas){ state.selected = null; openSelected(); render(); } });

/* Apply / Delete from inspector */
applyBtn.onclick = ()=>{
  const s = state.selected; if(!s) return alert('No element selected');
  const page = findPage(s.pageId); const el = page.elements.find(x=>x.id===s.id);
  el.label = labelInput.value;
  el.width = parseInt(widthInput.value) || el.width;
  el.height = parseInt(heightInput.value) || el.height;
  el.cornerRadius = cornerRadius.value !== '' ? parseInt(cornerRadius.value) : el.cornerRadius;
  el.borderWidth = parseInt(borderWidth.value) || 0;
  el.borderStyle = borderStyle.value;
  el.borderColor = borderColor.value;
  el.bgType = bgType.value;
  el.bgA = bgA.value; el.bgB = bgB.value; el.bgDir = bgDir.value;
  el.textColor = textColor.value;
  // action store (if navigate, prefer actionPageSelect)
  const at = actionType.value;
  let av = actionValue.value;
  if(at === 'navigate' && actionPageSelect.value) av = actionPageSelect.value;
  el.action = { type: at, value: av };
  render();
};
deleteBtn.onclick = ()=>{
  const s = state.selected; if(!s) return alert('No element selected');
  const page = findPage(s.pageId); page.elements = page.elements.filter(x=>x.id!==s.id);
  state.selected = null; render();
};

/* UI helpers */
bgType.onchange = updateBgControls;
function updateBgControls(){
  const t = bgType.value;
  if(t === 'solid'){ bgB.disabled = true; bgDir.disabled = true; dirLabel.style.opacity = '0.6'; }
  else { bgB.disabled = false; bgDir.disabled = false; dirLabel.style.opacity = '1'; }
}
actionType.onchange = updateActionControls;
function updateActionControls(){
  const t = actionType.value;
  if(t === 'navigate'){ actionValue.style.display='none'; actionPageSelect.style.display='block'; }
  else { actionValue.style.display='block'; actionPageSelect.style.display='none'; }
}

/* Export / Import / Copy */
exportBtn.onclick = ()=>{ jsonArea.value = JSON.stringify(state, null, 2); };
importBtn.onclick = ()=>{ try{ const data = JSON.parse(jsonArea.value); if(!data.pages) throw new Error('Invalid format'); state.pages = data.pages; state.currentPageId = data.currentPageId || data.pages[0]?.id || null; state.device = data.device || state.device; state.selected = null; renderPagesList(); render(); }catch(e){ alert('Import failed: '+e.message); } };
copyBtn.onclick = async ()=>{ const txt = jsonArea.value || JSON.stringify(state, null, 2); try{ await navigator.clipboard.writeText(txt); alert('Copied JSON'); }catch(e){ alert('Copy failed'); } };

/* Preview */
previewBtn.onclick = ()=> openPreview(state.currentPageId || state.pages[0]?.id);
function openPreview(startPageId){
  previewOverlay.style.display = 'flex';
  renderPreviewPage(startPageId);
  previewOverlay.addEventListener('click', function onBack(e){
    if(e.target === previewOverlay){ previewOverlay.style.display='none'; previewOverlay.removeEventListener('click', onBack); }
  });
}
function renderPreviewPage(pageId){
  previewCanvas.innerHTML = '';
  const page = findPage(pageId); if(!page) return;
  const frame = document.createElement('div'); frame.style.width='100%'; frame.style.height='100%'; frame.style.position='relative'; frame.style.background='#f7f7f7';
  const previewW = 420, previewH = 800;
  const sx = previewW / state.device.w, sy = previewH / state.device.h;
  page.elements.forEach(el=>{
    const d = document.createElement('div'); d.style.position='absolute';
    d.style.left = (el.x * sx) + 'px'; d.style.top = (el.y * sy) + 'px';
    d.style.width = (el.width * sx) + 'px'; d.style.height = (el.height * sy) + 'px';
    d.style.display='flex'; d.style.alignItems='center'; d.style.justifyContent='center'; d.style.boxSizing='border-box';
    d.style.color = el.textColor || '#000';
    if(el.bgType === 'solid') d.style.background = el.bgA;
    else if(el.bgType === 'linear') d.style.background = `linear-gradient(${el.bgDir}, ${el.bgA}, ${el.bgB})`;
    else if(el.bgType === 'radial') d.style.background = `radial-gradient(circle, ${el.bgA}, ${el.bgB})`;
    d.style.borderStyle = el.borderStyle || 'solid';
    d.style.borderWidth = (el.borderWidth != null ? (el.borderWidth * Math.max(sx,sy)) + 'px' : '0px');
    d.style.borderColor = el.borderColor || 'transparent';
    if(el.type === 'circle') d.style.borderRadius = '50%';
    else if(el.type === 'ellipse') d.style.borderRadius = '50% / 30%';
    else if(el.type === 'line'){ d.style.height = Math.max(2, (el.borderWidth||2) * Math.max(sx,sy)) + 'px'; d.style.width = (el.width * sx) + 'px'; d.textContent = ''; }
    else d.style.borderRadius = (el.cornerRadius != null ? (el.cornerRadius * Math.max(sx,sy)) + 'px' : '8px');
    d.textContent = (el.type==='button' || el.type==='box') ? (el.label || '') : '';
    d.style.cursor = el.action?.type ? 'pointer' : 'default';
    if(el.action?.type === 'navigate' && el.action.value){ d.addEventListener('click', (ev)=>{ ev.stopPropagation(); renderPreviewPage(el.action.value); }); }
    else if(el.action?.type === 'openUrl' && el.action.value){ d.addEventListener('click', (ev)=>{ ev.stopPropagation(); window.open(el.action.value, '_blank'); }); }
    else if(el.action?.type === 'alert' && el.action.value){ d.addEventListener('click', (ev)=>{ ev.stopPropagation(); alert(el.action.value); }); }
    frame.appendChild(d);
  });
  previewCanvas.appendChild(frame);
}

/* Device handling */
deviceSelect.onchange = ()=> {
  const [w,h] = deviceSelect.value.split('x').map(Number);
  state.device.w = w; state.device.h = h; applyDevice();
};
fitBtn.onclick = () => applyDevice();
window.onresize = applyDevice;

/* Initialize demo */
setTimeout(()=>{ state.device.w = 1024; state.device.h = 700; applyDevice(); createPage('Home'); createPage('Details'); state.pages[0].elements.push({ id: mkId('e'), type:'button', x:220, y:220, width:220, height:56, label:'Go to Details', bgType:'linear', bgA:'#007bff', bgB:'#0056d6', bgDir:'to right', textColor:'#fff', cornerRadius:8, borderWidth:0, borderStyle:'solid', borderColor:'#000', action:{type:'navigate',value: state.pages[1].id} }); state.pages[1].elements.push({ id: mkId('e'), type:'box', x:80, y:80, width:860, height:520, label:'Details', bgType:'solid', bgA:'#ffffff', textColor:'#111', cornerRadius:8, borderWidth:1, borderStyle:'dashed', borderColor:'#ccc' }); render(); }, 60);

</script>
</body>
</html>

